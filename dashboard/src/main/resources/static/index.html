<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹¤ì‹œê°„ ë‚ ì”¨ ìƒí™©íŒ</title>
    
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

    <style>
        /* [ì „ì—­ ìŠ¤íƒ€ì¼] */
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f1f5f9; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* [ìƒë‹¨ í—¤ë”] */
        .header {
            text-align: center;
            margin-bottom: 20px;
            color: #1e293b;
        }
        .header h1 { margin: 0; font-size: 1.5rem; font-weight: 800; }
        .header p { margin: 5px 0 0; font-size: 0.9rem; color: #64748b; }

        /* [ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ - í•µì‹¬!] */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* PC: ê°€ë¡œ 2ê°œ */
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* [ëª¨ë°”ì¼ ëŒ€ì‘: í™”ë©´ 600px ì´í•˜ì¼ ë•Œ] */
        @media (max-width: 600px) {
            .dashboard-grid {
                grid-template-columns: 1fr; /* í°: ê°€ë¡œ 1ê°œ (ì„¸ë¡œ ì •ë ¬) */
            }
        }

        /* [ë‚ ì”¨ ì¹´ë“œ ë””ìì¸] */
        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .card:active { transform: scale(0.98); } /* ëˆŒë €ì„ ë•Œ ì‚´ì§ ì‘ì•„ì§ */

        /* í…ìŠ¤íŠ¸ ì˜ì—­ */
        .card-info h2 { margin: 0; font-size: 1.1rem; color: #64748b; font-weight: 600; }
        .card-info .temp { font-size: 2.2rem; font-weight: 800; color: #334155; margin-top: 5px; display: block; }
        
        /* ì•„ì´ì½˜ ì˜ì—­ */
        .card-icon { font-size: 3rem; }

        /* [ë¹„ìƒ ìƒíƒœ (Alert) ìŠ¤íƒ€ì¼] */
        .card.alert {
            background-color: #fee2e2; /* ì—°í•œ ë¹¨ê°• ë°°ê²½ */
            border: 2px solid #ef4444; /* ì§„í•œ ë¹¨ê°• í…Œë‘ë¦¬ */
            animation: pulse 1s infinite; /* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ */
        }
        .card.alert .card-info h2 { color: #b91c1c; }
        .card.alert .temp { color: #991b1b; }

        /* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* [ì—°ê²° ìƒíƒœ í‘œì‹œ] */
        #connection-status {
            text-align: center; margin-top: 20px; font-size: 0.8rem; color: #94a3b8;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Dashboard</h1>
        <p>ì „êµ­ ì‹¤ì‹œê°„ ë‚ ì”¨ ëª¨ë‹ˆí„°ë§</p>
    </div>

    <div class="dashboard-grid">
        <div id="card-SEOUL" class="card">
            <div class="card-info">
                <h2>SEOUL (ë³¸ì‚¬)</h2>
                <span id="temp-SEOUL" class="temp">-</span>
            </div>
            <div class="card-icon" id="icon-SEOUL">â˜€ï¸</div>
        </div>

        <div id="card-BUSAN" class="card">
            <div class="card-info">
                <h2>BUSAN (2ê³µì¥)</h2>
                <span id="temp-BUSAN" class="temp">-</span>
            </div>
            <div class="card-icon" id="icon-BUSAN">ğŸŒŠ</div>
        </div>

        <div id="card-DAEGU" class="card">
            <div class="card-info">
                <h2>DAEGU (ë¬¼ë¥˜)</h2>
                <span class="temp">ì¤€ë¹„ì¤‘</span>
            </div>
            <div class="card-icon">â˜ï¸</div>
        </div>

        <div id="card-GWANGJU" class="card">
            <div class="card-info">
                <h2>GWANGJU (ìì¬)</h2>
                <span class="temp">ì¤€ë¹„ì¤‘</span>
            </div>
            <div class="card-icon">ğŸŒ§ï¸</div>
        </div>
    </div>

    <div id="connection-status">ğŸ”´ ì„œë²„ ì—°ê²° ì‹œë„ì¤‘...</div>

    <script>
        var stompClient = null;

        function connect() {
            // 1. ì„œë²„ì˜ /ws ì—”ë“œí¬ì¸íŠ¸ì— ì—°ê²°
            var socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            
            // ë””ë²„ê·¸ ë¡œê·¸ ë„ê¸° (ì½˜ì†” ê¹”ë”í•˜ê²Œ)
            stompClient.debug = null; 

            stompClient.connect({}, function (frame) {
                console.log('Connected: ' + frame);
                document.getElementById('connection-status').innerText = 'ğŸŸ¢ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹ ì¤‘';
                
                // 2. /topic/weather ì£¼ì†Œ êµ¬ë… (ë°ì´í„° ì˜¤ë©´ updateView ì‹¤í–‰)
                stompClient.subscribe('/topic/weather', function (message) {
                    var data = JSON.parse(message.body);
                    updateView(data);
                });
            }, function(error) {
                console.log("Connection Error: " + error);
                document.getElementById('connection-status').innerText = 'ğŸ”´ ì„œë²„ ì—°ê²° ëŠê¹€ (ì¬ì ‘ì† ì¤‘...)';
                setTimeout(connect, 3000); // 3ì´ˆ ë’¤ ì¬ì—°ê²° ì‹œë„
            });
        }

        function updateView(data) {
            // [ì„œìš¸ ì—…ë°ì´íŠ¸]
            if (data.SEOUL) {
                document.getElementById('temp-SEOUL').innerText = data.SEOUL + "Â°C";
            }

            // [ë¶€ì‚° ì—…ë°ì´íŠ¸] - íŠ¹ìˆ˜ ë¡œì§: ë¹„(RAIN) ì˜¤ë©´ ë¹¨ê°„ìƒ‰ ê²½ê³ !
            if (data.BUSAN) {
                var busanCard = document.getElementById('card-BUSAN');
                var busanIcon = document.getElementById('icon-BUSAN');
                var busanTemp = document.getElementById('temp-BUSAN');

                busanTemp.innerText = data.BUSAN + "Â°C";

                // ìƒíƒœê°’ í™•ì¸ (ë°±ì—”ë“œì—ì„œ BUSAN_STATUSë¥¼ ë³´ë‚´ì¤˜ì•¼ í•¨)
                if (data.BUSAN_STATUS === 'RAIN') {
                    busanCard.classList.add('alert'); // ë¹¨ê°„ìƒ‰+ê¹œë¹¡ì„ í´ë˜ìŠ¤ ì¶”ê°€
                    busanIcon.innerText = 'â›ˆï¸'; // ì•„ì´ì½˜ ë³€ê²½
                    busanTemp.innerText = data.BUSAN + "Â°C (í˜¸ìš°)";
                } else {
                    busanCard.classList.remove('alert'); // ì •ìƒ ë³µêµ¬
                    busanIcon.innerText = 'â˜€ï¸';
                }
            }
        }

        // ì•± ì‹œì‘ ì‹œ ì—°ê²°
        connect();
    </script>
</body>
</html>